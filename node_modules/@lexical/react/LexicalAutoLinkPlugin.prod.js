/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
'use strict';var k=require("@lexical/link"),n=require("@lexical/react/LexicalComposerContext"),p=require("@lexical/utils"),r=require("lexical"),t=require("react");function u(a){let c=new URLSearchParams;c.append("code",a);for(let b=1;b<arguments.length;b++)c.append("v",arguments[b]);throw Error(`Minified Lexical error #${a}; visit https://lexical.dev/docs/error?${c} for the full message or `+"use the non-minified dev environment for full errors and additional helpful warnings.");}
function v(a,c){for(let b=0;b<c.length;b++){let d=c[b](a);if(d)return d}return null}let w=/[.,;\s]/;function x(a){a=a.getPreviousSibling();r.$isElementNode(a)&&(a=a.getLastDescendant());var c;!(c=null===a||r.$isLineBreakNode(a))&&(c=r.$isTextNode(a))&&(a=a.getTextContent(),c=w.test(a[a.length-1]));return c}function y(a){a=a.getNextSibling();r.$isElementNode(a)&&(a=a.getFirstDescendant());return null===a||r.$isLineBreakNode(a)||r.$isTextNode(a)&&w.test(a.getTextContent()[0])}
function z(a,c,b,d){return(0<a?w.test(b[a-1]):x(d[0]))?c<b.length?w.test(b[c]):y(d[d.length-1]):!1}function A(a,c,b){let d=[],f=[],e=[],g=0,h=0;for(a=[...a];0<a.length;){let l=a[0],m=l.getTextContent().length,q=h;h+m<=c?(d.push(l),g+=m):q>=b?e.push(l):f.push(l);h+=m;a.shift()}return[g,d,f,e]}
function B(a,c,b,d){let f=k.$createAutoLinkNode(d.url,d.attributes);if(1===a.length){var e=a[0];0===c?[h,e]=e.splitText(b):[,h,e]=e.splitText(c,b);var g=r.$createTextNode(d.text);g.setFormat(h.getFormat());g.setDetail(h.getDetail());f.append(g);h.replace(f);return e}if(1<a.length){d=a[0];var h=d.getTextContent().length;0===c?e=d:[,e]=d.splitText(c);c=[];for(d=1;d<a.length;d++){let l=a[d],m=l.getTextContent().length,q=h,E=h+m;if(q<b)if(E<=b)c.push(l);else{let [F,G]=l.splitText(b-q);c.push(F);g=G}h+=
m}a=(b=r.$getSelection())?b.getNodes().find(r.$isTextNode):void 0;h=r.$createTextNode(e.getTextContent());h.setFormat(e.getFormat());h.setDetail(e.getDetail());f.append(h,...c);a&&a===e&&(r.$isRangeSelection(b)?h.select(b.anchor.offset,b.focus.offset):r.$isNodeSelection(b)&&h.select(0,h.getTextContent().length));e.replace(f);return g}}
function C(a,c,b){var d=[...a];a=d.map(g=>g.getTextContent()).join("");let f,e=0;for(;(f=v(a,c))&&null!==f;){let g=f.index,h=g+f.length;if(z(e+g,e+h,a,d)){let [l,,m,q]=A(d,e+g,e+h);d=(d=B(m,e+g-l,e+h-l,f))?[d,...q]:q;b(f.url,null);e=0}else e+=h;a=a.substring(h)}}
function D(a,c,b){var d=a.getChildren();let f=d.length;for(let e=0;e<f;e++){let g=d[e];if(!r.$isTextNode(g)||!g.isSimpleText()){H(a);b(null,a.getURL());return}}d=a.getTextContent();c=v(d,c);null===c||c.text!==d?(H(a),b(null,a.getURL())):x(a)&&y(a)?(d=a.getURL(),d!==c.url&&(a.setURL(c.url),b(c.url,d)),c.attributes&&(d=a.getRel(),d!==c.attributes.rel&&(a.setRel(c.attributes.rel||null),b(c.attributes.rel||null,d)),d=a.getTarget(),d!==c.attributes.target&&(a.setTarget(c.attributes.target||null),b(c.attributes.target||
null,d)))):(H(a),b(null,a.getURL()))}function H(a){let c=a.getChildren();var b=c.length;for(--b;0<=b;b--)a.insertAfter(c[b]);a.remove();return c.map(d=>d.getLatest())}
function I(a,c,b){t.useEffect(()=>{a.hasNodes([k.AutoLinkNode])||u(77);let d=(f,e)=>{b&&b(f,e)};return p.mergeRegister(a.registerNodeTransform(r.TextNode,f=>{var e=f.getParentOrThrow(),g=f.getPreviousSibling();if(k.$isAutoLinkNode(e))D(e,c,d);else if(!k.$isLinkNode(e)){if(f.isSimpleText()&&(w.test(f.getTextContent()[0])||!k.$isAutoLinkNode(g))){e=[f];for(g=f.getNextSibling();null!==g&&r.$isTextNode(g)&&g.isSimpleText();){e.push(g);if(/[\s]/.test(g.getTextContent()))break;g=g.getNextSibling()}C(e,
c,d)}let h=f.getPreviousSibling();e=f.getNextSibling();g=f.getTextContent();k.$isAutoLinkNode(h)&&!w.test(g[0])&&(h.append(f),D(h,c,d),f=h.getURL(),b&&b(null,f));k.$isAutoLinkNode(e)&&!w.test(g[g.length-1])&&(H(e),D(e,c,d),f=e.getURL(),b&&b(null,f))}}))},[a,c,b])}exports.AutoLinkPlugin=function({matchers:a,onChange:c}){let [b]=n.useLexicalComposerContext();I(b,a,c);return null};
exports.createLinkMatcherWithRegExp=function(a,c=b=>b){return b=>{b=a.exec(b);return null===b?null:{index:b.index,length:b[0].length,text:b[0],url:c(b[0])}}}
