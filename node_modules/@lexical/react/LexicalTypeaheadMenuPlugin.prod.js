/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
'use strict';var k=require("@lexical/react/LexicalComposerContext"),p=require("lexical"),y=require("react"),z=require("@lexical/utils"),A="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement?y.useLayoutEffect:y.useEffect;class B{constructor(b){this.key=b;this.ref={current:null};this.setRefElement=this.setRefElement.bind(this)}setRefElement(b){this.ref={current:b}}}
let C=b=>{const a=document.getElementById("typeahead-menu");if(a){var c=a.getBoundingClientRect();c.top+c.height>window.innerHeight&&a.scrollIntoView({block:"center"});0>c.top&&a.scrollIntoView({block:"center"});b.scrollIntoView({block:"nearest"})}};
function D(b){var a=p.$getSelection();if(!p.$isRangeSelection(a)||!a.isCollapsed())return null;var c=a.anchor;if("text"!==c.type)return null;a=c.getNode();if(!a.isSimpleText())return null;c=c.offset;let d=a.getTextContent().slice(0,c);var e=b.matchingString;b=b.replaceableString.length;for(let t=b;t<=e.length;t++)d.substr(-t)===e.substr(0,t)&&(b=t);b=c-b;if(0>b)return null;let r;0===b?[r]=a.splitText(c):[,r]=a.splitText(b,c);return r}
function G(b,a){let c=getComputedStyle(b),d="absolute"===c.position;a=a?/(auto|scroll|hidden)/:/(auto|scroll)/;if("fixed"===c.position)return document.body;for(;b=b.parentElement;)if(c=getComputedStyle(b),(!d||"static"!==c.position)&&a.test(c.overflow+c.overflowY+c.overflowX))return b;return document.body}function H(b,a){b=b.getBoundingClientRect();a=a.getBoundingClientRect();return b.top>a.top&&b.top<a.bottom}
function I(b,a,c,d){let [e]=k.useLexicalComposerContext();y.useEffect(()=>{if(null!=a&&null!=b){let r=e.getRootElement(),t=null!=r?G(r,!1):document.body,n=!1,h=H(a,t),f=function(){n||(window.requestAnimationFrame(function(){c();n=!1}),n=!0);const u=H(a,t);u!==h&&(h=u,null!=d&&d(u))},m=new ResizeObserver(c);window.addEventListener("resize",c);document.addEventListener("scroll",f,{capture:!0,passive:!0});m.observe(a);return()=>{m.unobserve(a);window.removeEventListener("resize",c);document.removeEventListener("scroll",
f,!0)}}},[a,e,d,c,b])}let J=p.createCommand("SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND");
function K({close:b,editor:a,anchorElementRef:c,resolution:d,options:e,menuRenderFn:r,onSelectOption:t,shouldSplitNodeWithQuery:n=!1,commandPriority:h=p.COMMAND_PRIORITY_LOW}){let [f,m]=y.useState(null);y.useEffect(()=>{m(0)},[d.match&&d.match.matchingString]);let u=y.useCallback(g=>{a.update(()=>{const l=null!=d.match&&n?D(d.match):null;t(g,l,b,d.match?d.match.matchingString:"")})},[a,n,d.match,t,b]),q=y.useCallback(g=>{const l=a.getRootElement();null!==l&&(l.setAttribute("aria-activedescendant",
"typeahead-item-"+g),m(g))},[a]);y.useEffect(()=>()=>{let g=a.getRootElement();null!==g&&g.removeAttribute("aria-activedescendant")},[a]);A(()=>{null===e?m(null):null===f&&q(0)},[e,f,q]);y.useEffect(()=>z.mergeRegister(a.registerCommand(J,({option:g})=>g.ref&&null!=g.ref.current?(C(g.ref.current),!0):!1,h)),[a,q,h]);y.useEffect(()=>z.mergeRegister(a.registerCommand(p.KEY_ARROW_DOWN_COMMAND,g=>{if(null!==e&&e.length&&null!==f){let l=f!==e.length-1?f+1:0;q(l);let v=e[l];null!=v.ref&&v.ref.current&&
a.dispatchCommand(J,{index:l,option:v});g.preventDefault();g.stopImmediatePropagation()}return!0},h),a.registerCommand(p.KEY_ARROW_UP_COMMAND,g=>{if(null!==e&&e.length&&null!==f){var l=0!==f?f-1:e.length-1;q(l);l=e[l];null!=l.ref&&l.ref.current&&C(l.ref.current);g.preventDefault();g.stopImmediatePropagation()}return!0},h),a.registerCommand(p.KEY_ESCAPE_COMMAND,g=>{g.preventDefault();g.stopImmediatePropagation();b();return!0},h),a.registerCommand(p.KEY_TAB_COMMAND,g=>{if(null===e||null===f||null==
e[f])return!1;g.preventDefault();g.stopImmediatePropagation();u(e[f]);return!0},h),a.registerCommand(p.KEY_ENTER_COMMAND,g=>{if(null===e||null===f||null==e[f])return!1;null!==g&&(g.preventDefault(),g.stopImmediatePropagation());u(e[f]);return!0},h)),[u,b,a,e,f,q,h]);let w=y.useMemo(()=>({options:e,selectOptionAndCleanUp:u,selectedIndex:f,setHighlightedIndex:m}),[u,f,e]);return r(c,w,d.match?d.match.matchingString:"")}
function L(b,a,c){let [d]=k.useLexicalComposerContext(),e=y.useRef(document.createElement("div")),r=y.useCallback(()=>{e.current.style.top=e.current.style.bottom;const n=d.getRootElement(),h=e.current;var f=h.firstChild;if(null!==n&&null!==b){const {left:u,top:q,width:w,height:g}=b.getRect();h.style.top=`${q+window.pageYOffset+e.current.offsetHeight+3}px`;h.style.left=`${u+window.pageXOffset}px`;h.style.height=`${g}px`;h.style.width=`${w}px`;if(null!==f){f.style.top=`${q}`;var m=f.getBoundingClientRect();
f=m.height;m=m.width;const l=n.getBoundingClientRect();u+m>l.right&&(h.style.left=`${l.right-m+window.pageXOffset}px`);(q+f>window.innerHeight||q+f>l.bottom)&&q-l.top>f&&(h.style.top=`${q-f+window.pageYOffset-g}px`)}h.isConnected||(null!=c&&(h.className=c),h.setAttribute("aria-label","Typeahead menu"),h.setAttribute("id","typeahead-menu"),h.setAttribute("role","listbox"),h.style.display="block",h.style.position="absolute",document.body.append(h));e.current=h;n.setAttribute("aria-controls","typeahead-menu")}},
[d,b,c]);y.useEffect(()=>{let n=d.getRootElement();if(null!==b)return r(),()=>{null!==n&&n.removeAttribute("aria-controls");let h=e.current;null!==h&&h.isConnected&&h.remove()}},[d,r,b]);let t=y.useCallback(n=>{null!==b&&(n||a(null))},[b,a]);I(b,e.current,r,t);return e}function M(b,a,c){var d=c.getSelection();if(null===d||!d.isCollapsed)return!1;c=d.anchorNode;d=d.anchorOffset;if(null==c||null==d)return!1;try{a.setStart(c,b),a.setEnd(c,d)}catch(e){return!1}return!0}
function N(b){let a=null;b.getEditorState().read(()=>{var c=p.$getSelection();if(p.$isRangeSelection(c)){var d=c.anchor;"text"!==d.type?a=null:(c=d.getNode(),c.isSimpleText()?(d=d.offset,a=c.getTextContent().slice(0,d)):a=null)}});return a}function O(b,a){return 0!==a?!1:b.getEditorState().read(()=>{var c=p.$getSelection();return p.$isRangeSelection(c)?(c=c.anchor.getNode().getPreviousSibling(),p.$isTextNode(c)&&c.isTextEntity()):!1})}function P(b){y.startTransition?y.startTransition(b):b()}
let Q=p.createCommand("SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND");
exports.LexicalTypeaheadMenuPlugin=function({options:b,onQueryChange:a,onSelectOption:c,onOpen:d,onClose:e,menuRenderFn:r,triggerFn:t,anchorClassName:n,commandPriority:h=p.COMMAND_PRIORITY_LOW}){let [f]=k.useLexicalComposerContext(),[m,u]=y.useState(null);n=L(m,u,n);let q=y.useCallback(()=>{u(null);null!=e&&null!==m&&e()},[e,m]),w=y.useCallback(g=>{u(g);null!=d&&null===m&&d(g)},[d,m]);y.useEffect(()=>{let g=f.registerUpdateListener(()=>{f.getEditorState().read(()=>{const l=f._window||window,v=l.document.createRange(),
E=p.$getSelection(),F=N(f);if(p.$isRangeSelection(E)&&E.isCollapsed()&&null!==F&&null!==v){var x=t(F,f);a(x?x.matchingString:null);null===x||O(f,x.leadOffset)||null===M(x.leadOffset,v,l)?q():P(()=>w({getRect:()=>v.getBoundingClientRect(),match:x}))}else q()})});return()=>{g()}},[f,t,a,m,q,w]);return null===m||null===f?null:y.createElement(K,{close:q,resolution:m,editor:f,anchorElementRef:n,options:b,menuRenderFn:r,shouldSplitNodeWithQuery:!0,onSelectOption:c,commandPriority:h})};
exports.MenuOption=B;exports.PUNCTUATION="\\.,\\+\\*\\?\\$\\@\\|#{}\\(\\)\\^\\-\\[\\]\\\\/!%'\"~=<>_:;";exports.SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND=Q;exports.getScrollParent=function(b,a){let c=getComputedStyle(b),d="absolute"===c.position;a=a?/(auto|scroll|hidden)/:/(auto|scroll)/;if("fixed"===c.position)return document.body;for(;b=b.parentElement;)if(c=getComputedStyle(b),(!d||"static"!==c.position)&&a.test(c.overflow+c.overflowY+c.overflowX))return b;return document.body};
exports.useBasicTypeaheadTriggerMatch=function(b,{minLength:a=1,maxLength:c=75}){return y.useCallback(d=>{d=(new RegExp("(^|\\s|\\()(["+b+"]((?:[^"+(b+"\\.,\\+\\*\\?\\$\\@\\|#{}\\(\\)\\^\\-\\[\\]\\\\/!%'\"~=<>_:;\\s]){0,")+c+"}))$")).exec(d);if(null!==d){let e=d[1],r=d[3];if(r.length>=a)return{leadOffset:d.index+e.length,matchingString:r,replaceableString:d[2]}}return null},[c,a,b])};exports.useDynamicPositioning=I
